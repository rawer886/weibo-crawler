# å¾®åšçˆ¬è™«

ä¸€ä¸ªç”¨äºæŠ“å–å¾®åšå†…å®¹å’Œè¯„è®ºçš„çˆ¬è™«å·¥å…·ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ã€è¯„è®ºå›å¤å…³ç³»è¯†åˆ«ç­‰åŠŸèƒ½ã€‚

## é¡¹ç›®ç»“æ„

```
weibo-crawler/
â”œâ”€â”€ config.py              # é…ç½®æ–‡ä»¶ï¼ˆåšä¸»åˆ—è¡¨ã€æŠ“å–å‚æ•°ç­‰ï¼‰
â”œâ”€â”€ crawler.py             # çˆ¬è™«æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ database.py            # æ•°æ®åº“æ“ä½œ
â”œâ”€â”€ main.py               # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–
â”œâ”€â”€ run.sh               # å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ scripts/             # æŸ¥è¯¢å’Œåˆ†æè„šæœ¬
â”‚   â”œâ”€â”€ query_blogger_comments.py  # æŸ¥è¯¢åšä¸»è¯„è®º
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ tests/               # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ test_single_post.py       # å•æ¡å¾®åšæµ‹è¯•
â”‚   â””â”€â”€ README.md
â””â”€â”€ data/                # æ•°æ®ç›®å½•ï¼ˆè¿è¡Œæ—¶äº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶ï¼‰
    â”œâ”€â”€ weibo.db         # SQLiteæ•°æ®åº“
    â”œâ”€â”€ cookies.json     # ç™»å½•cookiesï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
    â”œâ”€â”€ cache/           # APIå“åº”ç¼“å­˜
    â”œâ”€â”€ images/          # ä¸‹è½½çš„å›¾ç‰‡ï¼ˆæŒ‰åšä¸»å’Œæ—¥æœŸç»„ç»‡ï¼‰
    â”œâ”€â”€ logs/            # è¿è¡Œæ—¥å¿—
    â””â”€â”€ README.md        # æ•°æ®ç›®å½•è¯´æ˜
```

## åŠŸèƒ½ç‰¹æ€§

- âœ… è‡ªåŠ¨ç™»å½•å’Œcookieç®¡ç†
- âœ… æ”¯æŒå¤šä¸ªåšä¸»åŒæ—¶æŠ“å–
- âœ… æ–­ç‚¹ç»­ä¼ ï¼ˆæ”¯æŒå‘å‰æŠ“æ–°å¾®åšå’Œå‘åæŠ“å†å²ï¼‰
- âœ… æ—¶é—´èŒƒå›´é™åˆ¶ï¼ˆé»˜è®¤180å¤©ï¼‰
- âœ… è¯„è®ºæŠ“å–å»¶è¿Ÿç­–ç•¥ï¼ˆå¾®åšå‘å¸ƒNå¤©åæ‰æŠ“è¯„è®ºï¼‰
- âœ… **è¯„è®ºå›å¤å…³ç³»è¯†åˆ«**ï¼ˆä¸»è¯„è®ºå’Œå­è¯„è®ºçš„çˆ¶å­å…³ç³»ï¼‰
- âœ… å›¾ç‰‡ä¸‹è½½ï¼ˆæ”¯æŒæµè§ˆå™¨ç¼“å­˜ä¼˜å…ˆï¼‰
- âœ… APIå“åº”æ°¸ä¹…ç¼“å­˜ï¼ˆå‡å°‘é‡å¤è¯·æ±‚ï¼‰
- âœ… ä¼˜é›…åœæ­¢ï¼ˆCtrl+Cï¼‰

## æ•°æ®åº“ç»“æ„

### bloggers è¡¨
- uid, nickname, description, followers_count

### posts è¡¨
- mid, uid, content, created_at
- reposts_count, comments_count, likes_count
- is_repost, repost_uid, repost_nickname, repost_content
- images (JSON), local_images (JSON), video_url, source_url

### comments è¡¨
- comment_id, mid, uid, nickname, content, created_at, likes_count
- is_blogger_reply (æ˜¯å¦æ˜¯åšä¸»å›å¤)
- reply_to_comment_id, reply_to_uid, reply_to_nickname, reply_to_content

## å®‰è£…

1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd weibo-crawler
```

2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

3. å®‰è£… Playwright æµè§ˆå™¨
```bash
playwright install chromium
```

## é…ç½®

ç¼–è¾‘ `config.py`ï¼š

```python
# è¦å…³æ³¨çš„åšä¸»åˆ—è¡¨
BLOGGER_UIDS = [
    "1497035431",   # åšä¸»1
    "2014433131",   # åšä¸»2
]

# çˆ¬è™«é…ç½®
CRAWLER_CONFIG = {
    "min_delay": 8,              # è¯·æ±‚é—´éš”ï¼ˆç§’ï¼‰
    "max_delay": 30,
    "max_posts_per_run": 50,     # æ¯æ¬¡è¿è¡Œæœ€å¤šæŠ“å–å¾®åšæ•°
    "max_days": 180,             # æŠ“å–æ—¶é—´èŒƒå›´ï¼ˆå¤©ï¼‰
    "max_comments_per_post": 10, # æ¯æ¡å¾®åšæœŸæœ›æŠ“å–è¯„è®ºæ•°
    "comment_delay_days": 3,     # å¾®åšå‘å¸ƒå‡ å¤©åæ‰æŠ“è¯„è®º
    "headless": False,           # æ˜¯å¦æ— å¤´æ¨¡å¼
    "download_images": True,     # æ˜¯å¦ä¸‹è½½å›¾ç‰‡
}
```

## ä½¿ç”¨æ–¹æ³•

### 1. è¿è¡Œä¸»ç¨‹åº

```bash
source venv/bin/activate
python main.py
```

ç¬¬ä¸€æ¬¡è¿è¡Œä¼šè¦æ±‚æ‰‹åŠ¨ç™»å½•å¾®åšï¼Œç™»å½•åcookieä¼šè‡ªåŠ¨ä¿å­˜ã€‚

### 2. æŠ“å–æ¨¡å¼

- **new**: åªæŠ“å–æ–°å¾®åšï¼ˆä»æœ€æ–°å¼€å§‹ï¼Œé‡åˆ°å·²å…¥åº“çš„å°±åœæ­¢ï¼‰
- **history**: ç»§ç»­å‘åæŠ“å–å†å²å¾®åšï¼ˆä»ä¸Šæ¬¡åœä¸‹çš„ä½ç½®ç»§ç»­ï¼‰
- **all**: å…ˆæŠ“æ–°çš„ï¼Œå†æŠ“å†å²ï¼ˆé»˜è®¤ï¼‰

### 3. æŸ¥è¯¢åšä¸»è¯„è®º

```bash
python scripts/query_blogger_comments.py <å¾®åšID>
```

ç¤ºä¾‹è¾“å‡ºï¼š
```
ã€è¯„è®º 1ã€‘
  è¯„è®ºID: 5253489136775271_6329764758701369623
  æ—¶é—´: 26-1-10 13:51
  ç‚¹èµæ•°: 41
  ğŸ“ è¯„è®ºå†…å®¹: å‡ºæ¸…è¿˜è¦æ­»ä¸€æ‰¹
  â†³ @ä¸å‡ºè½¨äº†: æœ‰æˆ‘ä¸€ä¸ªSTå½’é›¶çš„å¥‰çŒ®
```

### 4. æµ‹è¯•å•æ¡å¾®åš

```bash
python tests/test_single_post.py <åšä¸»UID> <å¾®åšID>
```

è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ `tests/README.md` å’Œ `scripts/README.md`ã€‚

## è¯„è®ºå›å¤å…³ç³»

çˆ¬è™«èƒ½æ­£ç¡®è¯†åˆ«è¯„è®ºçš„å›å¤å…³ç³»ï¼š

- **ä¸»è¯„è®º**ï¼šç›´æ¥è¯„è®ºå¾®åš
- **å­è¯„è®º**ï¼šå›å¤ä¸»è¯„è®ºæˆ–å…¶ä»–å­è¯„è®º

æ•°æ®åº“å­—æ®µï¼š
- `reply_to_comment_id`: è¢«å›å¤è¯„è®ºçš„ID
- `reply_to_uid`: è¢«å›å¤è€…çš„UID
- `reply_to_nickname`: è¢«å›å¤è€…çš„æ˜µç§°
- `reply_to_content`: è¢«å›å¤çš„å†…å®¹

## æ³¨æ„äº‹é¡¹

1. **ç™»å½•**ï¼šé¦–æ¬¡è¿è¡Œéœ€è¦æ‰‹åŠ¨ç™»å½•ï¼Œä¹‹åä¼šè‡ªåŠ¨ä½¿ç”¨ä¿å­˜çš„cookies
2. **é€Ÿåº¦é™åˆ¶**ï¼šé»˜è®¤8-30ç§’éšæœºé—´éš”ï¼Œé¿å…è¢«å°
3. **è¯„è®ºå»¶è¿Ÿ**ï¼šé»˜è®¤å¾®åšå‘å¸ƒ3å¤©åæ‰æŠ“è¯„è®ºï¼Œè®©è¯„è®ºç¨³å®š
4. **æ—¶é—´èŒƒå›´**ï¼šé»˜è®¤åªæŠ“å–æœ€è¿‘180å¤©çš„å¾®åš
5. **ç¼“å­˜**ï¼šå†å²å¾®åšåˆ—è¡¨ä¼šæ°¸ä¹…ç¼“å­˜ï¼Œå‡å°‘é‡å¤è¯·æ±‚

## è®¸å¯è¯

MIT
